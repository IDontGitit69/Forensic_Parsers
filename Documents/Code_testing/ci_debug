# ============================================================================
# YARA Rule Validation Pipeline - DEBUG VERSION
# ============================================================================

variables:
  PYTHON_IMAGE: "python:3.9"
  YARA_ROOT: "Yara Rules"
  NEW_RULES_DIR: "Yara Rules/New_Rules"
  BASELINE_DIR: "Yara Rules/Baseline_Rules"
  REJECTED_DIR: "Yara Rules/Rejected_Rules"
  DATABASE_PATH: "Yara Rules/database/yara_rules.db"
  REPORTS_DIR: "Yara Rules/reports"
  TEMP_DIR: "Yara Rules/temp"
  TOOLS_DIR: "Yara Rules/Tools"

stages:
  - test

workflow:
  rules:
    - when: always

# ============================================================================
# DEBUG JOB
# ============================================================================
debug_check:
  stage: test
  image: $PYTHON_IMAGE
  tags:
    - yara-validation
  script:
    - echo "============================================"
    - echo "üîç DEBUG: Testing Directory Structure"
    - echo "============================================"
    - echo ""
    - echo "Current directory:"
    - pwd
    - echo ""
    - echo "============================================"
    - echo "üìÅ Root directory listing:"
    - echo "============================================"
    - ls -la
    - echo ""
    - echo "============================================"
    - echo "üìÅ Yara Rules directory:"
    - echo "============================================"
    - ls -la "Yara Rules/" || echo "‚ùå Yara Rules directory not found!"
    - echo ""
    - echo "============================================"
    - echo "üìÅ New_Rules directory:"
    - echo "============================================"
    - ls -la "$NEW_RULES_DIR" || echo "‚ùå New_Rules directory not found!"
    - echo ""
    - echo "============================================"
    - echo "üìÅ Tools directory:"
    - echo "============================================"
    - ls -la "$TOOLS_DIR" || echo "‚ùå Tools directory not found!"
    - echo ""
    - echo "============================================"
    - echo "üìÅ Database path:"
    - echo "============================================"
    - ls -la "$DATABASE_PATH" || echo "‚ùå Database not found!"
    - echo ""
    - echo "============================================"
    - echo "üìÑ Looking for YARA files in New_Rules:"
    - echo "============================================"
    - find "$NEW_RULES_DIR" -type f \( -name "*.yar" -o -name "*.yara" -o -name "*.rule" \) 2>/dev/null || echo "‚ùå No YARA files found"
    - echo ""
    - echo "============================================"
    - echo "‚úÖ DEBUG JOB COMPLETED"
    - echo "============================================"
